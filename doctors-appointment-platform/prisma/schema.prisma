generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model appointment {
  id                               String             @id
  patientId                        String
  doctorId                         String
  startTime                        DateTime
  endTime                          DateTime
  status                           appointment_status @default(SCHEDULED)
  notes                            String?            @db.Text
  patientDescription               String?            @db.Text
  videoSessionId                   String?
  videoSessionToken                String?            @db.Text
  createdAt                        DateTime           @default(now())
  updatedAt                        DateTime
  user_appointment_doctorIdTouser  user               @relation("appointment_doctorIdTouser", fields: [doctorId], references: [id], map: "Appointment_doctorId_fkey")
  user_appointment_patientIdTouser user               @relation("appointment_patientIdTouser", fields: [patientId], references: [id], map: "Appointment_patientId_fkey")

  @@index([doctorId, startTime], map: "Appointment_doctorId_startTime_idx")
  @@index([patientId], map: "Appointment_patientId_fkey")
  @@index([status, startTime], map: "Appointment_status_startTime_idx")
}

model availability {
  id        String              @id
  doctorId  String
  startTime DateTime
  endTime   DateTime
  status    availability_status @default(AVAILABLE)
  user      user                @relation(fields: [doctorId], references: [id], onDelete: Cascade, map: "Availability_doctorId_fkey")

  @@index([doctorId, startTime], map: "Availability_doctorId_startTime_idx")
}

model credittransaction {
  id        String                 @id
  userId    String
  amount    Int
  type      credittransaction_type
  packageId String?
  createdAt DateTime               @default(now())
  user      user                   @relation(fields: [userId], references: [id], onDelete: Cascade, map: "CreditTransaction_userId_fkey")

  @@index([userId], map: "CreditTransaction_userId_fkey")
}

model payout {
  id          String        @id
  doctorId    String
  amount      Float
  credits     Int
  platformFee Float
  netAmount   Float
  paypalEmail String
  status      payout_status @default(PROCESSING)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime
  processedAt DateTime?
  processedBy String?
  user        user          @relation(fields: [doctorId], references: [id], onDelete: Cascade, map: "Payout_doctorId_fkey")

  @@index([doctorId, status], map: "Payout_doctorId_status_idx")
  @@index([status, createdAt], map: "Payout_status_createdAt_idx")
}

model user {
  id                                      String                   @id
  clerkUserId                             String                   @unique(map: "User_clerkUserId_key")
  email                                   String                   @unique(map: "User_email_key")
  name                                    String?
  imageUrl                                String?
  role                                    user_role                @default(UNASSIGNED)
  createdAt                               DateTime                 @default(now())
  updatedAt                               DateTime
  credits                                 Int                      @default(2)
  specialty                               String?
  experience                              Int?
  credentialUrl                           String?
  description                             String?                  @db.Text
  verificationStatus                      user_verificationStatus? @default(PENDING)
  appointment_appointment_doctorIdTouser  appointment[]            @relation("appointment_doctorIdTouser")
  appointment_appointment_patientIdTouser appointment[]            @relation("appointment_patientIdTouser")
  availability                            availability[]
  credittransaction                       credittransaction[]
  payout                                  payout[]
}

enum credittransaction_type {
  CREDIT_PURCHASE
  APPOINTMENT_DEDUCTION
  ADMIN_ADJUSTMENT
}

enum availability_status {
  AVAILABLE
  BOOKED
  BLOCKED
}

enum appointment_status {
  SCHEDULED
  COMPLETED
  CANCELLED
}

enum user_role {
  UNASSIGNED
  PATIENT
  DOCTOR
  ADMIN
}

enum payout_status {
  PROCESSING
  PROCESSED
}

enum user_verificationStatus {
  PENDING
  VERIFIED
  REJECTED
}
